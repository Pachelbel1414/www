<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Test Viz of Book with Covers</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(3, 4, 5.5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // Lighting for shading
    const light = new THREE.DirectionalLight(0xffffff, 0.8);
    // light.position.set(4, 10, 5);
    light.position.set(6, 8, 11);
    scene.add(light);

    const ambient = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambient);

    // create a grainy texture
    const size = 256;
    const canvas = document.createElement('canvas');
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');

    // Draw simple noise for a grainy look
    const imageData = ctx.createImageData(size, size);
    for (let i = 0; i < imageData.data.length; i += 4) {
      const val = 100 + Math.random() * 40;
      imageData.data[i] = val;     // R
      imageData.data[i + 1] = val; // G
      imageData.data[i + 2] = val; // B
      imageData.data[i + 3] = 255; // A
    }
    ctx.putImageData(imageData, 0, 0);

    const grainyTexture = new THREE.CanvasTexture(canvas);
    grainyTexture.wrapS = grainyTexture.wrapT = THREE.RepeatWrapping;
    grainyTexture.repeat.set(8, 8);  // how dense the grain appears


    const pageCount = 250;

    // --- Create pages and covers ---
    for (let i = 0; i < pageCount; i++) {

      // --- Covers (first and last pages) ---
      if (i === 0 || i === pageCount - 1) {
        // Base rectangle shape (2x3)
        const rectShape = new THREE.Shape();
        rectShape.moveTo(0, 0);
        rectShape.lineTo(2.2, 0);
        rectShape.lineTo(2.2, 3.2);
        rectShape.lineTo(0, 3.2);
        rectShape.lineTo(0, 0);

        const extrudeSettings = {
          depth: 0.06,
          bevelEnabled: true,
          bevelThickness: 0.02,
          bevelSize: 0.02,
          bevelSegments: 2,
        };
        const coverGeometry = new THREE.ExtrudeGeometry(rectShape, extrudeSettings);
        coverGeometry.translate(0.4, -1.6, 0);

        const leatherMaterial = new THREE.MeshStandardMaterial({
          // side: THREE.DoubleSide,  // no grain
          map: grainyTexture,
          roughness: 0.8,
          metalness: 0.1,
          color: 0x236842,  // medium dark green
        });

        const cover = new THREE.Mesh(coverGeometry, leatherMaterial);
        cover.position.set(0, 1.5, 0);
        cover.rotation.y = (-90 * Math.PI / 180) + i * (1.0 / pageCount);
        scene.add(cover);
      }
      else
      {
        // Dog-eared shape (5 sides)
        const dogearShape = new THREE.Shape();
        dogearShape.moveTo(0, 0);
        dogearShape.lineTo(2, 0);
        dogearShape.lineTo(2, 3 - (i * 2.0/pageCount) );   // fold start slightly below top
        dogearShape.lineTo(2 - (i * 2.0/pageCount), 3);   // fold corner inward
        dogearShape.lineTo(0, 3);
        dogearShape.lineTo(0, 0);

        // slight page thickness
        const extrudeSettings = {
          depth: 0.001,
          bevelEnabled: false
        };
        // for now, go with simple shape
        // const pageGeometry = new THREE.ExtrudeGeometry(dogearShape, extrudeSettings);
        const pageGeometry = new THREE.ShapeGeometry(dogearShape);
        pageGeometry.translate(0.5, -1.5, 0);

        const hue = 0.1 + Math.random() * 0.05;
        const sat = 0.15 + Math.random() * 0.25;
        const lightness = 0.82 + Math.random() * 0.15;
        const color = new THREE.Color().setHSL(hue, sat, lightness);

        const material = new THREE.MeshStandardMaterial({
          color: color,
          side: THREE.DoubleSide,
          roughness: 0.8,
          metalness: 0.0,
        });

        const page = new THREE.Mesh(pageGeometry, material);
        page.position.set(0, 1.5, 0);
        page.rotation.y = (-90 * Math.PI / 180) + i * (1.0 / pageCount);
        scene.add(page);
      }
    }

    const grid = new THREE.GridHelper(10, 10);
    scene.add(grid);

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>